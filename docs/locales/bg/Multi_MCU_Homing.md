# Множество микроконтролери за насочване и сондиране

Klipper поддържа механизъм за самонасочване с краен ограничител, прикрепен към един микроконтролер, докато стъпковите му двигатели са на друг микроконтролер. Тази поддръжка се нарича "многомикрофонно самонасочване". Тази функция се използва и когато Z-сондата е на различен микроконтролер от Z-стъпковите двигатели.

Тази функция може да бъде полезна за опростяване на окабеляването, тъй като може да е по-удобно да се свърже краен ограничител или сонда към по-близък микроконтролер. Използването на тази функция обаче може да доведе до "превишаване на скоростта" на стъпковите двигатели по време на операциите за насочване и сондиране.

Превишението се дължи на възможни закъснения при предаването на съобщения между микроконтролера, който следи крайния ограничител, и микроконтролерите, които движат стъпковите двигатели. Кодът на Klipper е проектиран така, че да ограничи това забавяне до не повече от 25 ms. (Когато е активирано многофункционално насочване, микроконтролерите изпращат периодични съобщения за състоянието и проверяват дали съответните съобщения за състоянието са получени в рамките на 25 ms.)

Така например, ако самонасочването се извършва със скорост 10 mm/s, е възможно превишение до 0,250 mm (10 mm/s * .025s == 0,250 mm). Трябва да се внимава, когато се конфигурира многокомпонентно самонасочване, за да се отчете този тип превишение. Използването на по-бавни скорости на самонасочване или сондиране може да намали превишението.

Превишаването на скоростта на стъпковия двигател не трябва да оказва отрицателно въздействие върху точността на процедурата за насочване и сондиране. Кодът на Klipper ще открие превишението и ще го отчете в изчисленията си. Важно е обаче хардуерната конструкция да може да се справи с превишаването на скоростта, без това да доведе до повреда на машината.

In order to use this "multi-mcu homing" capability the hardware must have predictably low latency between the host computer and all of the micro-controllers. Typically the round-trip time must be consistently less than 10ms. High latency (even for short periods) is likely to result in homing failures.

Should high latency result in a failure (or if some other communication issue is detected) then Klipper will raise a "Communication timeout during homing" error.

Обърнете внимание, че ос с няколко стъпкови регулатора (например `stepper_z` и `stepper_z1`) трябва да бъде с един и същ микроконтролер, за да се използва многофункционално насочване. Например, ако крайният ограничител е на отделен микроконтролер от `stepper_z`, то `stepper_z1` трябва да е на същия микроконтролер като `stepper_z`.
