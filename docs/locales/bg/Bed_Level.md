# Изравняване на леглата

Изравняването на леглото (понякога наричано още "трамбоване на леглото") е от решаващо значение за получаването на висококачествени разпечатки. Ако леглото не е правилно "изравнено", това може да доведе до лоша адхезия на леглото, "изкривяване" и фини проблеми по време на разпечатването. Този документ служи като ръководство за извършване на изравняване на леглото в Klipper.

Важно е да разберете каква е целта на изравняването на леглото. Ако по време на отпечатване принтерът е командван в позиция `X0 Y0 Z10`, тогава целта е дюзата на принтера да бъде точно на 10 mm от леглото на принтера. Освен това, ако след това принтерът бъде командван в позиция `X50 Z10`, целта е дюзата да поддържа точното разстояние от 10 mm от леглото по време на цялото хоризонтално движение.

За да се получат разпечатки с добро качество, принтерът трябва да бъде калибриран така, че разстоянията Z да са с точност до около 25 микрона (0,025 мм). Това е малко разстояние - значително по-малко от ширината на типичен човешки косъм. Този мащаб не може да се измери "на око". Незначителни ефекти (като топлинното разширение) оказват влияние върху измерванията в този мащаб. Тайната за постигане на висока точност е да се използва повторяем процес и метод за нивелиране, който използва високата точност на собствената система за движение на принтера.

## Избор на подходящ механизъм за калибриране

При различните видове принтери се използват различни методи за изравняване на леглото. Всички те в крайна сметка зависят от "теста с хартия" (описан по-долу). Действителният процес за определен тип принтер обаче е описан в други документи.

Преди да стартирате който и да е от тези инструменти за калибриране, не забравяйте да извършите проверките, описани в документа [Config check document](Config_checks.md). Необходимо е да се провери основното движение на принтера, преди да се извърши изравняване на леглото.

За принтери с "автоматична Z-сонда" не забравяйте да калибрирате сондата, като следвате указанията в документа [Probe Calibrate](Probe_Calibrate.md). За делта-принтерите вижте документа [Delta Calibrate](Delta_Calibrate.md). За принтери с винтове за леглото и традиционни крайни ограничители Z, вижте документа [Ръчно ниво](Manual_Level.md).

По време на калибрирането може да се наложи да се зададе отрицателно число за Z `позиция_min` на принтера (например `позиция_min = -2`). Принтерът налага гранични проверки дори по време на процедурите за калибриране. Задаването на отрицателно число позволява на принтера да се движи под номиналната позиция на леглото, което може да помогне, когато се опитвате да определите действителната позиция на леглото.

## "Тестът на хартия"

Основният механизъм за калибриране на леглото е "тестът с хартия". Той включва поставяне на обикновено парче "копирна хартия" между леглото и дюзата на принтера, след което дюзата се командва на различни височини Z, докато се усети малко триене при бутане на хартията напред-назад.

Важно е да се разбере "хартиеният тест", дори ако човек разполага с "автоматична Z-сонда". Самата сонда често трябва да се калибрира, за да се получат добри резултати. Това калибриране на сондата се извършва с помощта на този "хартиен тест".

За да извършите теста с хартия, изрежете малко правоъгълно парче хартия с помощта на ножица (например 5x3 cm). Дебелината на хартията обикновено е около 100 микрона (0,100 mm). (Точната дебелина на хартията не е от решаващо значение.)

Първата стъпка от теста на хартията е да се проверят дюзата и леглото на принтера. Уверете се, че по дюзата или леглото няма пластмаса (или други замърсявания).

**Огледайте дюзата и леглото, за да се уверите, че няма наличие на пластмаса!**

Ако винаги се печата върху определена лента или повърхност за печат, може да се извърши тест на хартията с тази лента/повърхност на място. Все пак имайте предвид, че самата лента има дебелина и различните ленти (или всяка друга печатаща повърхност) ще повлияят на измерванията на Z. Не забравяйте да повторите теста на хартията, за да измерите всеки тип използвана повърхност.

Ако върху дюзата има пластмаса, загрейте екструдера и използвайте метална пинсета, за да я отстраните. Изчакайте екструдерът да се охлади напълно до стайна температура, преди да продължите с теста на хартия. Докато дюзата се охлажда, използвайте металната пинсета, за да отстраните пластмасата, която може да изтече.

**Винаги извършвайте теста на хартията, когато и дюзата, и леглото са на стайна температура!**

Когато дюзата се нагрява, нейното положение (спрямо леглото) се променя поради топлинно разширение. Това топлинно разширение обикновено е около 100 микрона, което е приблизително толкова, колкото е дебелината на типичен лист хартия за принтер. Точният размер на термичното разширение не е от решаващо значение, както не е от решаващо значение и точната дебелина на хартията. Започнете с предположението, че двете са равни (вижте по-долу метода за определяне на разликата между двете разстояния).

Може да ви се стори странно да калибрирате разстоянието при стайна температура, когато целта е да постигнете еднакво разстояние при нагряване. Въпреки това, ако се калибрира, когато дюзата е нагрята, има тенденция да се отделят малки количества разтопена пластмаса върху хартията, което променя усещането за триене. Това затруднява получаването на добро калибриране. Калибрирането, докато леглото/дюзата са горещи, също увеличава значително риска от изгаряне. Големината на топлинното разширение е стабилна, така че лесно се отчита по-късно в процеса на калибриране.

**Използвайте автоматичен инструмент за определяне на точните Z височини!**

Klipper разполага с няколко помощни скрипта (например MANUAL_PROBE, Z_ENDSTOP_CALIBRATE, PROBE_CALIBRATE, DELTA_CALIBRATE). Вижте документите [описани по-горе](#choose-the-appropriate-calibration-mechanism), за да изберете един от тях.

Изпълнете съответната команда в терминалния прозорец на OctoPrint. Скриптът ще поиска взаимодействие от потребителя в изхода на терминала OctoPrint. Той ще изглежда по следния начин:

```
Отзоваване: // Стартиране на ръчна Z-сонда. Използвайте TESTZ, за да регулирате позицията ѝ.
 Recv: // Завършете с команда ACCEPT или ABORT. 
Recv: // Позиция Z: ?????? --> 5.000 <-- ??????
```

Текущата височина на дюзата (както принтерът я разбира в момента) се показва между символите "--> <--". Числото вдясно е височината на последния опит на сондата, която е само по-голяма от текущата височина, а вляво е последният опит на сондата, който е по-малък от текущата височина (или ??????, ако не е направен опит).

Поставете хартията между дюзата и леглото. Може да е полезно да сгънете ъгъла на хартията, за да я хванете по-лесно. (Опитайте се да не натискате леглото, когато премествате хартията напред-назад.)

![paper-test](img/paper-test.jpg)

Използвайте командата TESTZ, за да поискате дюзата да се доближи до хартията. Например:

```
TESTZ Z=-.1
```

Командата TESTZ ще премести дюзата на относително разстояние от текущата позиция на дюзата. (Така `Z=-.1` изисква дюзата да се доближи до леглото с .1 mm.) След като дюзата спре да се движи, избутайте хартията напред-назад, за да проверите дали дюзата е в контакт с хартията и да усетите степента на триене. Продължете да издавате команди TESTZ, докато не усетите малко количество триене при тестването с хартията.

Ако се установи твърде голямо триене, може да се използва положителна стойност на Z, за да се премести дюзата нагоре. Възможно е също така да се използва `TESTZ Z=+` или `TESTZ Z=-`, за да се "бисектира" последната позиция - т.е. да се премести в позиция по средата между две позиции. Например, ако от команда TESTZ се получи следната подсказка:

```
Recv: // Z position: 0.130 --> 0.230 <-- 0.280
```

След това с `TESTZ Z=-` дюзата ще се премести в позиция Z от 0,180 (половината път между 0,130 и 0,230). Човек може да използва тази функция, за да помогне за бързото ограничаване на постоянното триене. Възможно е също така да използвате `Z=++` и `Z=--`, за да се върнете директно към минало измерване - например, след горната подсказка командата `TESTZ Z=--` ще премести дюзата в позиция Z от 0,130.

След като откриете малко количество триене, изпълнете командата ACCEPT:

```
ПРИЕМАНЕ
```

Това ще приеме зададената височина Z и ще продължи с дадения инструмент за калибриране.

Точният размер на усещаното триене не е от решаващо значение, точно както не е от решаващо значение размерът на топлинното разширение и точната ширина на хартията. Просто се опитайте да получите едно и също ниво на триене всеки път, когато провеждате теста.

Ако нещо се обърка по време на теста, можете да използвате командата `ABORT`, за да излезете от инструмента за калибриране.

## Определяне на топлинното разширение

След успешното изравняване на леглото може да се премине към изчисляване на по-точна стойност за комбинираното въздействие на "топлинното разширение", "дебелината на хартията" и "степента на триене, усетена по време на изпитването на хартията".

Този тип изчисления обикновено не са необходими, тъй като повечето потребители смятат, че простият "хартиен тест" дава добри резултати.

Най-лесният начин да направите това изчисление е да отпечатате тестови обект, който има прави стени от всички страни. За целта може да се използва големият кух квадрат, който се намира в [docs/prints/square.stl](prints/square.stl). Когато нарязвате обекта, уверете се, че нарязващото устройство използва същата височина на слоя и ширина на екструдиране за първото ниво, както за всички следващи слоеве. Използвайте груба височина на слоя (височината на слоя трябва да е около 75% от диаметъра на дюзата) и не използвайте ръб или сал.

Отпечатайте тестовия обект, изчакайте да изстине и го извадете от леглото. Проверете най-долния слой на обекта. (Също така може да е полезно да прокарате пръст или нокът по долния ръб.) Ако установите, че долният слой е леко изпъкнал от всички страни на обекта, това означава, че дюзата е била малко по-близо до леглото, отколкото трябва. Може да се издаде команда `SET_GCODE_OFFSET Z=+.010`, за да се увеличи височината. При последващи разпечатки може да се провери това поведение и да се направи допълнителна настройка, ако е необходимо. Подобни корекции обикновено се извършват в десетки микрони (0,010 мм).

Ако долният слой постоянно изглежда по-тесен от следващите слоеве, можете да използвате командата SET_GCODE_OFFSET, за да направите отрицателна Z корекция. Ако не сте сигурни, можете да намалите корекцията Z, докато най-долният слой на отпечатъците не покаже малка изпъкналост, и след това да я намалите, докато изчезне.

Най-лесният начин за прилагане на желаната Z корекция е да се създаде макрос START_PRINT g-code, да се организира извикването на този макрос от режещата машина в началото на всяко отпечатване и да се добави командата SET_GCODE_OFFSET към този макрос. За повече подробности вижте документа [slicers](Slicers.md).
