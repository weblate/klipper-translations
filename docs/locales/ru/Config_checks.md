# Проверки конфигурации

В этом документе приведен список действий, которые помогут подтвердить настройки выводов (pin) в файле Klipper printer.cfg. Рекомендуется выполнить эти шаги после выполнения шагов, описанных в [документе по установке](Installation.md).

Во время работы с этим руководством может потребоваться внести изменения в конфигурационный файл Klipper. Обязательно выполняйте команду RESTART после каждого изменения в файле конфигурации, чтобы убедиться, что изменение вступило в силу (введите «restart» на вкладке терминала Octoprint, а затем нажмите «Отправить»). Также рекомендуется запускать команду STATUS после каждого RESTART, чтобы убедиться, что файл конфигурации успешно загружен.

## Проверьте температуру

Начните с проверки правильности сообщения о температуре. Перейдите к разделу графика температуры в пользовательском интерфейсе. Убедитесь, что температура сопла и стола (если возможно) присутствует и не увеличивается. Если оно увеличивается, отключите питание принтера. Если температуры неточные, проверьте настройки «sensor_type» и «sensor_pin» для сопла и/или стола.

## Проверьте M112

Перейдите к командной консоли и введите команду 'M112' в окне терминала. Эта команда просит Klipper перейти в состояние «выключения». Это приведет к появлению ошибки, которую можно устранить с помощью команды 'FIRMWARE_RESTART' в командной консоли. Octoprint также потребует повторного подключения. Затем перейдите к разделу графика температуры и убедитесь, что температура продолжает обновляться и не увеличивается. Если температура повышается, отключите питание принтера.

## Проверьте нагреватели

Перейдите в раздел графика температуры и введите 50 в поле температуры экструдера. Температура экструдера на графике должна начать расти (примерно в течение 30 секунд). Затем перейдите список температуры экструдера и выберите «Выкл.». Через несколько минут температура должна вернуться к исходному значению. Если температура не повышается, проверьте настройку «heater_pin» в конфигурации.

Если в принтере есть стол с подогревом, повторите вышеуказанный тест со столом.

## Проверьте пин включения шагового двигателя (enable pin)

Убедитесь, что все оси принтера могут свободно перемещаться вручную (шаговые двигатели отключены). Если нет, подайте команду 'M84', чтобы отключить двигатели. Если какая-либо из осей по-прежнему не может свободно перемещаться, проверьте конфигурацию "enable_pin" шагового двигателя для данной оси. В большинстве стандартных драйверов шаговых двигателей контакт включения двигателя имеет «активный низкий уровень», поэтому перед "enable_pin" должен стоять символ "!" (например, "enable_pin: !PA1").

## Проверьте концевики (endstops)

Вручную переместите все оси принтера так, чтобы ни одна из них не соприкасалась с концевым упором. Отправьте команду 'QUERY_ENDSTOPS' через командную консоль. В ответ должно появиться текущее состояние всех сконфигурированных концевых упоров, и все они должны сообщить о состоянии "open". Для каждой конечной точки повторно запустите команду 'QUERY_ENDSTOPS', запуская конечную точку вручную. Команда 'QUERY_ENDSTOPS' должна сообщать о конечной остановке: «TRIGGERED».

Если конечная точка появляется обратной (Оно сообщает "open" когда срабатывает и наоборот), тогда добавьте "!" к определению PIN (например, "endstop_pin: ^PA2") либо уберите "!" если уже присутствует.

Если состояние концевика вообще не меняется, это обычно указывает на то, что он подключен к другому контакту. Однако может также потребоваться изменение настройки подтяжки вывода (символ «^» в начале имени endstop_pin — в большинстве принтеров используется подтягивающий резистор, и символ «^» должен присутствовать).

## Проверьте шаговые двигатели

Используйте команду STEPPER_BUZZ для проверки подключения шаговых моторов. Начните вручную выставлять оси на середине и введите `STEPPER_BUZZ STEPPER=stepper_x` в командной консоли. Команда STEPPER_BUZZ даёт шаг движения один миллиметр в одну сторону и возвращается на стартовую позицию. (Если концевики получили position_endstop=0 при старте движения будет двигаться от точки нахождения концевика.) Эти колебания производятся 10 раз.

Если шаговый двигатель вообще не двигается, проверьте настройки "enable_pin" и "step_pin" для шагового двигателя. Если шаговый двигатель перемещается, но не возвращается в исходное положение, проверьте настройку «dir_pin». Если шаговый двигатель вращается в неправильном направлении, это обычно указывает на то, что «dir_pin» для оси необходимо инвертировать. Это делается путем добавления '!' в «dir_pin» в файле конфигурации принтера (или удалив его, если он уже есть). Если двигатель перемещается значительно больше или значительно меньше одного миллиметра, проверьте настройку «rotation_distance».

Запустите приведенный выше тест для каждого шагового двигателя, указанного в файле конфигурации. (Установите параметр STEPPER команды STEPPER_BUZZ на имя проверяемого раздела конфигурации.) Если в экструдере нет нити, можно использовать STEPPER_BUZZ для проверки подключения двигателя экструдера (используйте STEPPER=extruder). В противном случае лучше протестировать двигатель экструдера отдельно (см. следующий раздел).

После проверки всех концевых выключателей и проверки всех шаговых двигателей следует проверить механизм возврата в исходное положение. Введите команду G28 для возврата всех осей в исходное положение (домой). Отключите питание принтера, если он не возвращается в исходное положение должным образом. При необходимости повторите этапы проверки концевого выключателя и шагового двигателя.

## Проверьте мотор экструдера

Для теста мотора экструдера необходимо будет разогреть экструдер до температуры печати. Перейдите в меню температуры и выберите нужную температуру из температурного списка (или введите вручную нужную температуру). Подождите когда принтер нагреется до нужной температуры. Затем перейдите в командную консоль и нажмите кнопку "Экструдировать". Проверьте чтобы моторы экструдера были правильно подключены. Если это не так, вы увидите сообщение об ошибке в приведённых секциях "enable_pin", "step_pin", и "dir_pin" настройках экструдера.

## Калибровка настроек PID

Klipper поддерживает [PID-регулирование](https://ru.wikipedia.org/wiki/ПИД-регулятор) для экструдера и нагревателя стола. Чтобы использовать этот механизм управления, необходимо откалибровать настройки PID на каждом принтере (настройки PID, найденные в других прошивках или в образцах файлов конфигурации, часто работают плохо).

Для калибровки температуры экструдера, введите в консоли команду PID_CALIBRATE. Пример: `PID_CALIBRATE HEATER=extruder TARGET=170`

По завершении тестовой настройки запустите `SAVE_CONFIG`, чтобы обновить файл print.cfg с новыми настройками PID.

Если в принтере есть стол с подогревом и он поддерживает управление с помощью PWM (широтно-импульсной модуляции), то рекомендуется использовать PID-регулирование для стола. (Когда нагреватель стола управляется с помощью алгоритма PID, он может включаться и выключаться десять раз в секунду, что может не подходить для нагревателей с механическим переключателем.) Типичная команда калибровки PID стола: `PID_CALIBRATE HEATER=heater_bed TARGET=60`

## Следующие шаги

Это руководство призвано помочь с базовой проверкой настроек контактов (pins) в файле конфигурации Klipper. Обязательно прочитайте руководство [bed leveling](Bed_Level.md). Также см. документ [Slicers](Slicers.md) для получения информации о настройке слайсера для работы с Klipper.

После того, как вы убедились, что базовые функции печати работают, рекомендуется откалибровать [pressure advance](Pressure_Advance.md).

Возможно, потребуется выполнить другие типы детальной калибровки принтера — чтобы помочь с этим, в Интернете доступен ряд руководств (например, выполните поиск в Интернете по запросу «калибровка 3D-принтера»). Например, если вы столкнулись с эффектом, называемым рябь, вы можете попробовать выполнить настройку по руководству [компенсации резонанса](Resonance_Compensation.md).
